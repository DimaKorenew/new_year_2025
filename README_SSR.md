# SSR/SSG/ISR Configuration

Этот проект настроен для поддержки:
- **SSG (Static Site Generation)** - статическая генерация для основных страниц
- **ISR (Incremental Static Regeneration)** - инкрементальная регенерация для динамических страниц (shared lists)
- **SSR (Server-Side Rendering)** - серверный рендеринг для краулеров и при необходимости

## Архитектура

### Статические страницы (SSG)
- Главная страница (`/`)
- Страница с префиксом (`/new-year-2025/`)

Эти страницы предрендерятся на этапе сборки и отдаются как статические HTML файлы.

### Динамические страницы (ISR)
- Страницы общих списков (`/s/:shareId`)

Эти страницы кэшируются и периодически регенерируются в фоновом режиме.

### SSR для краулеров
Все страницы отдаются с полным SSR контентом для поисковых краулеров (Google, Yandex и др.), обеспечивая одинаковый контент для пользователей и краулеров.

## Скрипты

### Разработка
```bash
# Обычная разработка (CSR)
npm run dev

# Разработка с SSR
npm run dev:ssr
```

### Сборка
```bash
# Полная сборка (клиент + сервер + prerender)
npm run build

# Или по шагам:
npm run build:client  # Сборка клиентского бандла
npm run build:server  # Сборка серверного бандла
npm run build:prerender  # Предрендеринг статических страниц
```

### Предпросмотр
```bash
# Предпросмотр статической сборки
npm run preview

# Предпросмотр с SSR
npm run preview:ssr
```

## Конфигурация

### Переменные окружения

- `NODE_ENV` - окружение (development/production)
- `PORT` - порт для SSR сервера (по умолчанию 5174)
- `FORCE_SSR` - принудительный SSR для всех запросов (true/false)
- `ISR_REVALIDATE` - время жизни кэша ISR в секундах (по умолчанию 3600)

### Определение краулеров

Система автоматически определяет запросы от поисковых краулеров по User-Agent:
- Google (Googlebot, Google-InspectionTool)
- Yandex (YandexBot, YandexMobileBot и др.)
- Bing (Bingbot)
- Другие популярные краулеры

Для краулеров всегда используется SSR для обеспечения полного контента.

## Структура файлов

```
src/
  entry-client.tsx    # Клиентский entry point (гидратация)
  entry-server.tsx    # Серверный entry point (SSR)
  utils/
    crawlerDetection.ts  # Утилита для определения краулеров

server/
  ssr.js              # SSR сервер
  isr.js              # ISR middleware

scripts/
  prerender.js        # Скрипт предрендеринга

dist/
  client/             # Клиентский бандл
  server/             # Серверный бандл
  .isr-cache/         # Кэш ISR (генерируется автоматически)
```

## Развертывание

### Статический хостинг (SSG)
Для статического хостинга используйте результат `npm run build`. Файлы в `dist/client/` можно развернуть на любом статическом хостинге.

### SSR хостинг
Для SSR требуется Node.js сервер. Используйте `npm run preview:ssr` или настройте процесс-менеджер (PM2, systemd и т.д.) для запуска `server/ssr.js`.

### Docker
SSR сервер можно запустить в Docker контейнере. Убедитесь, что порт настроен правильно.

## SEO

Благодаря SSR для краулеров:
- ✅ Полный HTML контент для поисковых систем
- ✅ Правильные meta теги (Open Graph)
- ✅ Одинаковый контент для пользователей и краулеров
- ✅ Быстрая индексация

## Производительность

- **Статические страницы**: Мгновенная отдача из кэша
- **Динамические страницы**: ISR с фоновой регенерацией
- **Краулеры**: Полный SSR для лучшей индексации
- **Обычные пользователи**: Статический HTML с гидратацией (быстрее)


